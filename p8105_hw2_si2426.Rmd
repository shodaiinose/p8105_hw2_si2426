---
title: "p8105_hw2_si2426"
output: github_document
date: "2022-09-27"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(dplyr)
library(readxl)
library(stringr)
```

## Problem 1

```{r loading_data, message = FALSE}
transit_df = read_csv("./data/NYC_Transit_Subway_Entrance_And_Exit_Data.csv") %>% janitor::clean_names() %>% select(line, station_name, station_latitude, station_longitude, route1:route11, entrance_type, entry, vending, ada) %>% mutate(entry = recode(entry, "YES" = TRUE, NO = FALSE))
```

```{r}
head(transit_df, 5)
```

The data is not yet tidy as there are quite a few cells with missing values. In order to minimize this, each route number and route should be independent variables.
There are `r nrow(distinct(transit_df %>% group_by(line, station_name)))` distinct stations. `r nrow(transit_df %>% filter(ada == TRUE))` of the stations are ADA compliant. The proportion of entrances/exits without vending that allow entrance is `r round(nrow(transit_df %>% filter (vending == "NO", entry == TRUE))/nrow(transit_df %>% filter (vending == "NO")), 2)`.

```{r data_reformat, message = FALSE}
transit_df_reformat = transit_df %>% mutate(route8 = as.character(route8), route9 = as.character(route9), route10 = as.character(route10), route11 = as.character(route11)) %>% pivot_longer(route1:route11, names_to = "route_number", values_to = "route_name")
```

There are `r nrow(transit_df_reformat %>% filter(route_name == "A") %>% distinct(line, station_name))` distinct stations that serve the A train. Of the stations that serve the A train, `r nrow(transit_df_reformat %>% filter(route_name == "A", ada == "TRUE") %>% distinct(line, station_name))` are ADA compliant.


## Problem 2

Mr. Trash Wheel
```{r, message = FALSE}
mr_trash_df = read_excel("./data/Trash-Wheel-Collection-Totals-7-2020-2.xlsx", sheet = "Mr. Trash Wheel", range = cell_cols(c("A:N"))) %>% janitor::clean_names() %>% na.omit(dumpster) %>% mutate(sports_balls = as.integer(round(sports_balls))) %>% mutate(dumpster = as.numeric(dumpster)) %>% mutate(type = "mr")
```

```{r}
head(mr_trash_df, 5)
```

Professor Trash Wheel
```{r, message = FALSE}
prof_trash_df = read_excel("./data/Trash-Wheel-Collection-Totals-7-2020-2.xlsx", sheet = "Professor Trash Wheel", range = cell_cols(c("A:N"))) %>% janitor::clean_names() %>% na.omit(dumpster) %>% mutate(sports_balls = as.integer(round(sports_balls))) %>% mutate(type = "professor")
```

```{r}
head(prof_trash_df, 5)
```

Combined Dataset
```{r, message = FALSE}
combined_trash_df = bind_rows(mr_trash_df, prof_trash_df)
```

```{r}
head(combined_trash_df, 5)
```

The combined dataset contains `r nrow(combined_trash_df)` observations across both Mr. and Professor Trash Wheel. The key variables include the dumpster number, date of collection, weight of total litter per dumpster, and various types of litter collected. The types of litter include the following: plastic bottles, polystyrene, cigarette butts, glass bottles, grocery bags, chip bags, and sport balls. A variable specifying if a dumpster was Mr. Trash Wheel or Professor Trash Wheel has also been included to distinguish between the two types. The total weight of trash collected by Professor Trash Wheel was `r combined_trash_df %>% filter(type == "professor") %>% select(weight_tons) %>% colSums() %>% as.numeric` kg. The total number of sports balls collected by Mr. Trash Wheel in 2020 was `r combined_trash_df %>% filter(type == "mr", year == 2020) %>% select(sports_balls) %>% colSums() %>% as.numeric` balls.


## Problem 3

National Politicians
```{r, message = FALSE}
pols_month_df = read_csv("./data/fivethirtyeight_datasets/pols-month.csv") %>% separate(col = mon, into= c("year", "month", "day")) %>% mutate(month = factor(month.name[(as.numeric(month))], levels = month.name)) %>% mutate(year = as.numeric(year)) %>% mutate(president = ifelse(prez_dem == 1, "dem", "gop")) %>% select(-c(prez_dem, prez_gop, day)) %>% arrange(year, month)
```

```{r}
head(pols_month_df, 5)
```

Standard & Poor's Stock Market Index
```{r, message = FALSE}
snp_df = read_csv("./data/fivethirtyeight_datasets/snp.csv") %>% mutate(date = as.Date(date, format = "%m/%d/%y")) %>% separate(col = date, into = c("year", "month", "day")) %>% mutate(month = factor(month.name[(as.numeric(month))], levels = month.name)) %>% mutate(year = as.numeric(year)) %>% select(-c(day)) %>% arrange(year, month)
```

```{r}
head(snp_df, 5)
```

Unemployment
```{r, message = FALSE}
unemployment_df = read_csv("./data/fivethirtyeight_datasets/unemployment.csv") %>% janitor::clean_names() %>% pivot_longer(jan:dec, names_to = "month", values_to = "unemployment_rate") %>% mutate(month = str_to_sentence(month)) %>% mutate(month = factor(month, levels = month.abb, labels = month.name))
```

```{r}
head(unemployment_df, 5)
```

Combined Dataset
```{r, message = FALSE}
fiverthirtyeight_join_df = full_join(pols_month_df, snp_df) %>% full_join(unemployment_df)
```

```{r}
head(fiverthirtyeight_join_df, 5)
```

The National Politicians dataset contains the number of politicians who are either Democrats or Republicans in a given period. The dataset contains `r ncol(pols_month_df)` variables, `r nrow(pols_month_df)` observations, and a range of `r (pols_month_df %>% select(year) %>% max()) - (pols_month_df %>% select(year) %>% min())` years. The key variables include the following: the year and month of a time period with the corresponding numbers of Republican and Democratic governors, senators, and representatives. It also notes the party of the President. The Standard & Poor's Stock Market Index dataset contains the number of observations related to the stock market. The dataset contains `r ncol(snp_df)` variables, `r nrow(snp_df)` observations, and a range of `r (snp_df %>% select(year) %>% max()) - (snp_df %>% select(year) %>% min())` years. The key variables include the following: the date and the closing value of the stock market index on that date. The unemployment dataset notes the unemployment rate at a given time. The dataset contains `r ncol(unemployment_df)` variables, `r nrow(unemployment_df)` observations, and a range of `r (unemployment_df %>% select(year) %>% max()) - (unemployment_df %>% select(year) %>% min())` years. The key variables include the following: the year, the month, and the associated unemployment rate. Using left joins to merge the datasets, the resulting dataset has `r ncol(fiverthirtyeight_join_df)` variables, `r nrow(fiverthirtyeight_join_df)` observations, and a range of `r fiverthirtyeight_join_df %>% select(year) %>% max() - fiverthirtyeight_join_df %>% select(year) %>% min()` years. The combined dataset contains every variable from each dataset mentioned above.






